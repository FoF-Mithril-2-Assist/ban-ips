module.exports=function(t){var a={};function n(s){if(a[s])return a[s].exports;var e=a[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,n),e.l=!0,e.exports}return n.m=t,n.c=a,n.d=function(t,a,s){n.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,a){if(1&a&&(t=n(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var e in t)n.d(s,e,function(a){return t[a]}.bind(null,e));return s},n.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(a,"a",a),a},n.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},n.p="",n(n.s=23)}([function(t,a){t.exports=flarum.core.compat.Model},function(t,a){t.exports=flarum.core.compat["components/Button"]},function(t,a,n){"use strict";function s(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a}n.d(a,"a",(function(){return s}))},function(t,a){t.exports=flarum.core.compat["components/Alert"]},function(t,a){t.exports=flarum.core.compat["helpers/punctuateSeries"]},function(t,a){t.exports=flarum.core.compat.extend},function(t,a){t.exports=flarum.core.compat["helpers/username"]},function(t,a){t.exports=flarum.core.compat["components/Modal"]},function(t,a,n){"use strict";n.d(a,"a",(function(){return h}));var s=n(2),e=n(7),i=n.n(e),r=n(1),o=n.n(r),p=n(3),d=n.n(p),l=n(4),u=n.n(l),h=function(t){function a(){return t.apply(this,arguments)||this}Object(s.a)(a,t);var n=a.prototype;return n.init=function(){if(this.address=this.props.address,this.post=this.props.post,this.user=this.props.user||this.post&&this.post.user(),!this.user&&this.address){var t=app.store.getBy("banned_ips","address",this.address);t&&(this.user=t.user())}this.banOptions=[],(this.post&&this.post.ipAddress()||this.address)&&this.banOptions.push("only"),this.user&&this.banOptions.push("all"),this.banOption=m.prop(this.banOptions[0]),this.reason=m.prop(""),this.otherUsers={},this.loading=!1},n.className=function(){return"Modal--medium"},n.title=function(){return app.translator.trans("fof-ban-ips.lib.modal.title")},n.content=function(){var t=this,a=this.otherUsers[this.banOption()],n=a&&a.map((function(t){return t&&t.displayName()||app.translator.trans("core.lib.username.deleted_text")}));return m("div",{className:"Modal-body"},m("p",null,app.translator.trans("fof-ban-ips.lib.modal.ban_ip_confirmation")),m("div",{className:"Form-group"},this.banOptions.map((function(a){return m("div",null,m("input",{type:"radio",name:"ban-option",id:"ban-option-"+a,checked:t.banOption()===a,onclick:t.banOption.bind(t,a)})," ",m("label",{htmlFor:"ban-option-"+a},app.translator.trans("fof-ban-ips.forum.modal.ban_options_"+a+"_ip",{user:t.user,ip:t.address||t.post&&t.post.ipAddress()})))}))),m("div",{className:"Form-group"},m("label",{className:"label"},app.translator.trans("fof-ban-ips.lib.modal.reason_label")),m("input",{type:"text",className:"FormControl",bidi:this.reason})),a?a.length?d.a.component({children:app.translator.transChoice("fof-ban-ips.lib.modal.ban_ip_users",n.length,{users:u()(n)}),dismissible:!1}):d.a.component({children:app.translator.trans("fof-ban-ips.forum.modal.ban_ip_no_users"),dismissible:!1,type:"success"}):"",a&&m("br",null),m("div",{className:"Form-group"},m(o.a,{className:"Button Button--primary",type:"submit",loading:this.loading},n?app.translator.trans("fof-ban-ips.lib.modal.ban_button"):app.translator.trans("fof-ban-ips.lib.modal.check_button"))))},n.onsubmit=function(t){var a=this;if(t.preventDefault(),this.loading=!0,void 0===this.otherUsers[this.banOption()])return this.getOtherUsers();var n={reason:this.reason(),userId:this.user.id()};"only"===this.banOption()?(n.address=this.post.ipAddress(),app.store.createRecord("banned_ips").save(n).then(this.hide.bind(this)).catch(this.onerror.bind(this)).then(this.loaded.bind(this))):"all"===this.banOption()&&app.request({data:{data:{attributes:n}},url:""+app.forum.attribute("apiUrl")+this.user.apiEndpoint()+"/ban",method:"POST",errorHandler:this.onerror.bind(this)}).then((function(t){return app.store.pushPayload(t).forEach(a.done.bind(a))})).then(this.hide.bind(this)).catch((function(){})).then(this.loaded.bind(this))},n.getOtherUsers=function(){var t=this,a={};"only"===this.banOption()&&(a.ip=this.address||this.post.ipAddress()),app.request({data:a,url:app.forum.attribute("apiUrl")+"/fof/ban-ips/check-users/"+this.user.id(),method:"GET",errorHandler:this.onerror.bind(this)}).then((function(a){t.otherUsers[t.banOption()]=a.data.map((function(t){return app.store.pushObject(t)})).filter((function(t){return 0===t.bannedIPs().length})),t.loading=!1})).catch((function(){})).then(this.loaded.bind(this))},n.done=function(t){var a={type:"banned_ips",id:t.id()};this.post&&(this.post.data.relationships.banned_ip={data:a}),this.user.data.relationships.banned_ips||(this.user.data.relationships.banned_ips={data:[]}),this.user.data.relationships.banned_ips.data.push(a),this.user.data.attributes.isBanned=!0,app.store.pushObject(this.user.data)},a}(i.a)},function(t,a,n){"use strict";n.d(a,"a",(function(){return l}));var s=n(2),e=n(1),i=n.n(e),r=n(3),o=n.n(r),p=n(4),d=n.n(p),l=(n(6),function(t){function a(){return t.apply(this,arguments)||this}Object(s.a)(a,t);var n=a.prototype;return n.title=function(){return app.translator.trans("fof-ban-ips.lib.modal.unban_title")},n.content=function(){var t=this,a=this.otherUsers[this.banOption()],n=a&&a.map((function(t){return t&&t.displayName()||app.translator.trans("core.lib.username.deleted_text")}));return this.bannedIPs?m("div",{className:"Modal-body"},o.a.component({children:app.translator.trans("fof-ban-ips.lib.modal.unbanned_ips",{ips:d()(this.bannedIPs)}),dismissible:!1,type:"success"})):m("div",{className:"Modal-body"},m("p",null,app.translator.trans("fof-ban-ips.lib.modal.unban_ip_confirmation")),m("div",{className:"Form-group"},this.banOptions.map((function(a){return m("div",null,m("input",{type:"radio",name:"ban-option",id:"ban-option-"+a,checked:t.banOption()===a,onclick:t.banOption.bind(t,a)})," ",m("label",{htmlFor:"ban-option-"+a},app.translator.trans("fof-ban-ips.lib.modal.unban_options_"+a+"_ip",{user:t.user,ip:t.address||t.post&&t.post.ipAddress()})))}))),a?a.length?o.a.component({children:app.translator.transChoice("fof-ban-ips.lib.modal.unban_ip_users",n.length,{users:d()(n)}),dismissible:!1}):o.a.component({children:app.translator.trans("fof-ban-ips.lib.modal.unban_ip_no_users"),dismissible:!1,type:"success"}):"",a&&m("br",null),m("div",{className:"Form-group"},m(i.a,{className:"Button Button--primary",type:"submit",loading:this.loading},n?app.translator.trans("fof-ban-ips.lib.modal.unban_button"):app.translator.trans("fof-ban-ips.lib.modal.check_button"))))},n.onsubmit=function(t){if(t.preventDefault(),this.loading=!0,void 0===this.otherUsers[this.banOption()])return this.getOtherUsers();var a={};if("only"===this.banOption()){a.address=this.address||this.post.ipAddress();var n=this.post?this.post.bannedIP():app.store.getBy("banned_ips","address",this.address);n.delete().then(this.done.bind(this,n)).catch(this.onerror.bind(this)).then(this.hide.bind(this))}else"all"===this.banOption()&&app.request({data:{data:{attributes:a}},url:""+app.forum.attribute("apiUrl")+this.user.apiEndpoint()+"/unban",method:"POST",errorHandler:this.onerror.bind(this)}).then(this.done.bind(this)).catch(this.onerror.bind(this)).then(this.hide.bind(this))},n.getOtherUsers=function(){var t=this,a={};"only"===this.banOption()&&(a.ip=this.address||this.post.ipAddress(),a.skipValidation=!0);var n=app.forum.attribute("apiUrl")+"/fof/ban-ips/check-users";this.user&&(n+="/"+this.user.id()),app.request({data:a,url:n,method:"GET",errorHandler:this.onerror.bind(this)}).then((function(a){var n=app.store.pushPayload(a);t.otherUsers[t.banOption()]=n.filter((function(t){return 1===t.bannedIPs().length})),t.loading=!1,m.lazyRedraw()})).catch((function(){})).then(this.loaded.bind(this))},n.done=function(t){this.loading=!1,this.post&&delete this.post.data.relationships.banned_ip,this.user&&!this.user.data.relationships&&(t instanceof app.store.models.banned_ips?(this.user.data.relationships.banned_ips={data:this.user.data.relationships.banned_ips.data.filter((function(a){return a.id!==t.id()}))},this.user.data.attributes.isBanned=0!==this.user.data.relationships.banned_ips.data.length):t||(this.user.data.relationships.banned_ips.data=[],this.user.data.attributes.isBanned=!1)),t&&Array.isArray(t.data)&&(this.bannedIPs=t.data.map((function(t){return t.attributes.address})),this.loading=!1,m.lazyRedraw())},n.hide=function(){t.prototype.hide.call(this),this.props.redraw||location.reload()},a}(n(8).a))},function(t,a,n){"use strict";n.d(a,"a",(function(){return o}));var s=n(2),e=n(0),i=n.n(e),r=n(11),o=function(t){function a(){return t.apply(this,arguments)||this}return Object(s.a)(a,t),a.prototype.apiEndpoint=function(){return"/fof/ban-ips"+(this.exists?"/"+this.id():"")},a}(n.n(r)()(i.a,{creator:i.a.hasOne("creator"),user:i.a.hasOne("user"),address:i.a.attribute("address"),reason:i.a.attribute("reason"),createdAt:i.a.attribute("createdAt",i.a.transformDate),deletedAt:i.a.attribute("deletedAt",i.a.transformDate)}))},function(t,a){t.exports=flarum.core.compat["utils/mixin"]},,,,,function(t,a){t.exports=flarum.core.compat["components/PermissionGrid"]},function(t,a){t.exports=flarum.core.compat["components/AdminNav"]},function(t,a){t.exports=flarum.core.compat["components/AdminLinkButton"]},function(t,a){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,a){t.exports=flarum.core.compat["components/Placeholder"]},function(t,a){t.exports=flarum.core.compat["components/Page"]},function(t,a){t.exports=flarum.core.compat.Component},function(t,a,n){"use strict";n.r(a);var s=n(0),e=n.n(s),i=n(10),r=n(5),o=n(16),p=n.n(o),d=n(17),l=n.n(d),u=n(18),h=n.n(u),c=n(2),f=n(1),b=n.n(f),g=n(19),v=n.n(g),_=n(20),y=n.n(_),O=n(21),N=n.n(O),A=n(7),x=n.n(A),B=n(3),F=n.n(B),P=n(4),j=n.n(P),w=n(6),k=n.n(w),I=function(t){function a(){return t.apply(this,arguments)||this}Object(c.a)(a,t);var n=a.prototype;return n.init=function(){this.address=m.prop(""),this.reason=m.prop(""),this.usersBanned={},this.loading=!1},n.className=function(){return"Modal--medium"},n.title=function(){return app.translator.trans("fof-ban-ips.lib.modal.title")},n.content=function(){var t=this.usersBanned[this.address()],a=t&&t.map(k.a);return m("div",{className:"Modal-body"},m("p",null,app.translator.trans("fof-ban-ips.lib.modal.ban_ip_confirmation")),m("div",{className:"Form-group"},m("label",{className:"label"},app.translator.trans("fof-ban-ips.lib.modal.address_label")),m("input",{type:"text",className:"FormControl",bidi:this.address,required:!0,pattern:"^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])$|^\\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)){3}))|:)))(%.+)?\\s*$"})),m("div",{className:"Form-group"},m("label",{className:"label"},app.translator.trans("fof-ban-ips.lib.modal.reason_label")),m("input",{type:"text",className:"FormControl",bidi:this.reason})),t?t.length?F.a.component({children:app.translator.transChoice("fof-ban-ips.lib.modal.ban_ip_users",a.length,{users:j()(a)}),dismissible:!1}):F.a.component({children:app.translator.trans("fof-ban-ips.admin.modal.ban_ip_no_users"),dismissible:!1,type:"success"}):"",t&&m("br",null),m("div",{className:"Form-group"},m(b.a,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:app.store.getBy("banned_ips","address",this.address())},a?app.translator.trans("fof-ban-ips.lib.modal.ban_button"):app.translator.trans("fof-ban-ips.lib.modal.check_button"))))},n.onsubmit=function(t){if(t.preventDefault(),this.address()){if(this.loading=!0,void 0===this.usersBanned[this.address()])return this.getOtherUsers();var a={address:this.address(),reason:this.reason()};app.store.createRecord("banned_ips").save(a).then(this.hide.bind(this),this.onerror.bind(this),this.loaded.bind(this))}},n.getOtherUsers=function(){var t=this,a={ip:this.address()};app.request({data:a,url:app.forum.attribute("apiUrl")+"/fof/ban-ips/check-users",method:"GET"}).then((function(a){t.usersBanned[t.address()]=a.data.map((function(t){return app.store.pushObject(t)})),m.lazyRedraw()})).then(this.loaded.bind(this)).catch((function(a){t.onerror(a),t.loading=!1}))},a}(x.a),U=n(22),z=n.n(U),R=n(9),M=function(t){function a(){return t.apply(this,arguments)||this}Object(c.a)(a,t);var n=a.prototype;return n.init=function(){this.item=this.props.item,this.reason=m.prop(this.item.reason())},n.className=function(){return"Modal--medium"},n.title=function(){return app.translator.trans("fof-ban-ips.admin.modal.update_title")},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",{className:"label"},app.translator.trans("fof-ban-ips.lib.modal.reason_label")),m("input",{type:"text",className:"FormControl",bidi:this.reason})),m("div",{className:"Form-group"},m(b.a,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.reason()===this.item.reason()},app.translator.trans("fof-ban-ips.lib.modal.save_button"))))},n.onsubmit=function(t){t.preventDefault(),this.reason()&&(this.loading=!0,this.item.save({reason:this.reason()}).then(this.hide.bind(this)).catch(this.onerror.bind(this)).then(this.loaded.bind(this)))},a}(x.a),S=function(t){function a(){return t.apply(this,arguments)||this}Object(c.a)(a,t);var n=a.prototype;return n.init=function(){this.item=this.props.bannedIP},n.view=function(){var t=this;return m("tr",null,m("td",null,this.item.id()),m("td",null,k()(this.item.creator())),m("td",null,this.item.user()&&k()(this.item.user())),m("td",null,this.item.address()),m("td",null,this.item.reason()),m("td",null,this.item.createdAt().toLocaleDateString()),m("td",null,m("div",{className:"Button--group"},b.a.component({className:"Button Button--warning",icon:"fas fa-pencil-alt",disabled:this.item.creator()!==app.session.user,onclick:function(){return app.modal.show(new M({item:t.item}))}}),b.a.component({className:"Button Button--danger",icon:"fas fa-times",onclick:function(){return app.modal.show(new R.a({address:t.item.address(),redraw:!0}))}}))))},a}(z.a),C=function(t){function a(){return t.apply(this,arguments)||this}Object(c.a)(a,t);var n=a.prototype;return n.init=function(){t.prototype.init.call(this),this.loading=!0,this.page=0,this.pageSize=20},n.config=function(a){t.prototype.config.apply(this,arguments),a||this.refresh()},n.view=function(){var t,a;return!0===this.nextResults&&(t=b.a.component({className:"Button Button--PageList-next",icon:"fas fa-angle-right",onclick:this.loadNext.bind(this)})),!0===this.prevResults&&(a=b.a.component({className:"Button Button--PageList-prev",icon:"fas fa-angle-left",onclick:this.loadPrev.bind(this)})),m("div",{className:"BannedIPsPage"},m("div",{className:"BannedIPsPage-header"},m("div",{className:"container"},m("p",null,app.translator.trans("fof-ban-ips.admin.nav.desc")),b.a.component({className:"Button Button--primary",icon:"fas fa-plus",children:app.translator.trans("fof-ban-ips.admin.page.create_button"),onclick:function(){return app.modal.show(new I)}}))),m("br",null),m("div",{className:"BannedIpsPage-table"},m("div",{className:"container"},this.loading?v.a.component():app.store.all("banned_ips").length?m("table",{style:{width:"100%",textAlign:"left"},className:"table"},m("thead",null,m("tr",null,m("th",null,"#"),m("th",null,app.translator.trans("fof-ban-ips.admin.page.creator_label")),m("th",null,app.translator.trans("fof-ban-ips.admin.page.user_label")),m("th",null,app.translator.trans("fof-ban-ips.admin.page.address_label")),m("th",null,app.translator.trans("fof-ban-ips.admin.page.reason_label")),m("th",null,app.translator.trans("fof-ban-ips.admin.page.date_label")),m("th",null))),m("tbody",null,app.store.all("banned_ips").slice(this.page,this.page+this.pageSize).map((function(t){return S.component({bannedIP:t})})))):m("div",null,y.a.component({text:app.translator.trans("fof-ban-ips.admin.empty_text")})))),m("div",null,t,a))},n.refresh=function(){return this.loadResults().then(this.parseResults.bind(this))},n.loadResults=function(){var t=this.page*this.pageSize;return app.store.find("fof/ban-ips",{page:{offset:t,limit:this.pageSize}})},n.loadNext=function(){!0===this.nextResults&&(this.page++,this.refresh())},n.loadPrev=function(){!0===this.prevResults&&(this.page--,this.refresh())},n.parseResults=function(t){this.loading=!1,this.nextResults=!!t.payload.links.next,this.prevResults=!!t.payload.links.prev,m.lazyRedraw()},a}(N.a);app.initializers.add("fof/ban-ips",(function(){app.store.models.banned_ips=i.a,app.store.models.users.prototype.bannedIPs=e.a.hasMany("banned_ips"),Object(r.extend)(p.a.prototype,"moderateItems",(function(t){t.add("viewBannedIPList",{icon:"fas fa-gavel",label:app.translator.trans("fof-ban-ips.admin.permissions.view_banned_ip_list_label"),permission:"fof.ban-ips.viewBannedIPList"}),t.add("banIP",{icon:"fas fa-gavel",label:app.translator.trans("fof-ban-ips.admin.permissions.ban_ip_label"),permission:"fof.ban-ips.banIP"})})),app.routes["fof-ban-ips"]={path:"/fof/ban-ips",component:C.component()},app.extensionSettings["fof-ban-ips"]=function(){return m.route(app.route("fof-ban-ips"))},Object(r.extend)(l.a.prototype,"items",(function(t){t.add("fof-ban-ips",h.a.component({href:app.route("fof-ban-ips"),icon:"fas fa-gavel",children:app.translator.trans("fof-ban-ips.admin.nav.title"),description:app.translator.trans("fof-ban-ips.admin.nav.desc")}))}))}))}]);
//# sourceMappingURL=admin.js.map